<!DOCTYPE html><html><head><meta charset="utf-8"><title>Untitled Document.md</title><style></style></head><body id="preview">
<h1><a id="PlexDataProviders_0"></a>PlexDataProviders</h1>
<p>Java framework for managing general-purpose data providers
##Overview</p>
<p>PlexDataProviders is a light-weight Java framework that abstract access to various data providers such as databases, files, web services, etc. It allows aggregation of data from various data providers.</p>
<p>The PlexDataProviders framework is divided into two components:</p>
<ul>
<li>Data Provider - This component defines interfaces that are implemented to access data sources such as database or web services.</li>
<li>Query Engine - This component is used for querying and aggregating data.</li>
</ul>
<p>The query engine can determine dependency between providers and it also allow you to use output of one of the data provider as input to another data provider. For example, letâ€™s assume:</p>
<ul>
<li>data-provider A requires input-a1, input-a2 and produces output-a1, output-a2</li>
<li>data-provider B requires input-b1 and output-a1 and produces output-b1, output-b2
Then you can pass input-a1, input-a2 to the query engine and request output-a1, output-a2, output-b1, output-b2 output data fields.</li>
</ul>
<p>##Building</p>
<ul>
<li>Download and install &lt;a href=&quot;<a href="http://www.gradle.org/downloads">http://www.gradle.org/downloads</a>&quot;&gt;Gradle&lt;/a&gt;.</li>
<li>Download and install &lt;a href=&quot;<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a>&quot;&gt;Java 8&lt;/a&gt;.</li>
<li>Checkout code using</li>
</ul>
<pre><code>git clone git@github<span class="hljs-class">.com</span>:bhatti/PlexDataProviders<span class="hljs-class">.git</span>
</code></pre>
<ul>
<li>Compile and build jar file using</li>
</ul>
<pre><code><span class="hljs-title">gradle</span> jar
</code></pre>
<ul>
<li>Copy and add jar file (build/libs/DataProviders-0.1-SNAPSHOT.jar) manually in your application.</li>
</ul>
<p>##Version</p>
<ul>
<li>0.5</li>
</ul>
<p>##License</p>
<ul>
<li>MIT</li>
</ul>
<h2><a id="Data_Structure_40"></a>Data Structure</h2>
<p>Following are primary data structures:</p>
<ul>
<li>MetaField - This class defines meta information for each data field such as name, category, type, etc.</li>
<li>MetaFieldType - This enum class supports primitive data types supported</li>
<li>Metadata - This class defines set of MetaField</li>
<li>DataRow - This class abstracts row of data fields</li>
<li>DataRowSet - This class abstracts set of rows</li>
</ul>
<p>PlexDataProviders also supports nested structures where a data field can be instance of DataRowSet.</p>
<h3><a id="Adding_a_Data_Provider_51"></a>Adding a Data Provider</h3>
<p>The data provider implements following two interfaces</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DataProducer</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">produce</span><span class="hljs-params">(DataRowSet requestFields, DataRowSet responseFields,
            DataConfiguration config)</span> <span class="hljs-keyword">throws</span> DataProviderException</span>;
}

</code></pre>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DataProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DataProducer</span>, <span class="hljs-title">Comparable</span>&lt;<span class="hljs-title">DataProvider</span>&gt; </span>{
    <span class="hljs-function">String <span class="hljs-title">getName</span><span class="hljs-params">()</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getRank</span><span class="hljs-params">()</span></span>;

    <span class="hljs-function">Metadata <span class="hljs-title">getMandatoryRequestFields</span><span class="hljs-params">()</span></span>;

    <span class="hljs-function">Metadata <span class="hljs-title">getOptionalRequestFields</span><span class="hljs-params">()</span></span>;

    <span class="hljs-function">Metadata <span class="hljs-title">getResponseFields</span><span class="hljs-params">()</span></span>;

    <span class="hljs-function">TaskGranularity <span class="hljs-title">getTaskGranularity</span><span class="hljs-params">()</span></span>;
}
</code></pre>
<p>Each provider defines name, rank (or priority when matching for best provider), set of mandatory/optional input and output data fields. The data provider can also define granularity as coarse grain or fine grain and the implementation may execute those providers on different threads.</p>
<p>PlexDataProviders also provides interfaces for converting data from domain objects to DataRowSet.  Here is an example of implementation:</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecuritiesBySymbolsProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseProvider</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Metadata parameterMeta = Metadata.from(SharedMeta.symbol);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Metadata optionalMeta = Metadata.from();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SecurityMarshaller marshaller = <span class="hljs-keyword">new</span> SecurityMarshaller();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SecuritiesBySymbolsProvider</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>(<span class="hljs-string">"SecuritiesBySymbolsProvider"</span>, parameterMeta, optionalMeta,
                marshaller.getMetadata());
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">produce</span><span class="hljs-params">(DataRowSet parameter, DataRowSet response,
            DataConfiguration config)</span> <span class="hljs-keyword">throws</span> DataProviderException </span>{
        <span class="hljs-keyword">final</span> String id = parameter.getValueAsText(SharedMeta.symbol, <span class="hljs-number">0</span>);
        Map&lt;String, Object&gt; criteria = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
        criteria.put(<span class="hljs-string">"symbol"</span>, id.toUpperCase());
        Collection&lt;Security&gt; securities = DaoLocator.securityDao.query(criteria);
        DataRowSet rowset = marshaller.marshal(securities);
        addRowSet(response, rowset, <span class="hljs-number">0</span>);
    }
}
</code></pre>
<p>The SecurityMarshaller will define methods to convert domain objects to DataRowSet such as:</p>
<pre><code class="language-java"><span class="hljs-function"><span class="hljs-keyword">public</span> DataRowSet <span class="hljs-title">marshal</span><span class="hljs-params">(Security security)</span> </span>{
    DataRowSet rowset = <span class="hljs-keyword">new</span> DataRowSet(responseMeta);
    marshal(rowset, security, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> rowset;
}

<span class="hljs-function"><span class="hljs-keyword">public</span> DataRowSet <span class="hljs-title">marshal</span><span class="hljs-params">(Collection&lt;Security&gt; securities)</span> </span>{
    DataRowSet rowset = <span class="hljs-keyword">new</span> DataRowSet(responseMeta);
    <span class="hljs-keyword">for</span> (Security security : securities) {
        marshal(rowset, security, rowset.size());
    }
    <span class="hljs-keyword">return</span> rowset;
}
...
</code></pre>
<p>PlexDataProviders provides DataProviderLocator interface for registering and looking up provider, e.g.</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DataProviderLocator</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(DataProvider provider)</span></span>;

    <span class="hljs-function">Collection&lt;DataProvider&gt; <span class="hljs-title">locate</span><span class="hljs-params">(Metadata requestFields, Metadata responseFields)</span></span>;
...
}
</code></pre>
<p>PlexDataProviders comes with a small application that provides data services by implementing various data providers. It uses PlexService framework for defining the service, e.g.</p>
<pre><code class="language-java"><span class="hljs-annotation">@WebService</span>
<span class="hljs-annotation">@Path</span>(<span class="hljs-string">"/data"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">DataService</span> </span>{
    <span class="hljs-keyword">private</span> DataProviderLocator dataProviderLocator = <span class="hljs-keyword">new</span> DataProviderLocatorImpl();
    <span class="hljs-keyword">private</span> QueryEngine queryEngine = <span class="hljs-keyword">new</span> QueryEngineImpl(dataProviderLocator);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DataServiceImpl</span><span class="hljs-params">()</span> </span>{
        dataProviderLocator.register(<span class="hljs-keyword">new</span> AccountsByIdsProvider());
        dataProviderLocator.register(<span class="hljs-keyword">new</span> AccountsByUseridProvider());
        dataProviderLocator.register(<span class="hljs-keyword">new</span> CompaniesBySymbolsProvider());
        dataProviderLocator.register(<span class="hljs-keyword">new</span> OrdersByAccountIdsProvider());
        dataProviderLocator.register(<span class="hljs-keyword">new</span> PositionGroupsBySymbolsProvider());
        dataProviderLocator.register(<span class="hljs-keyword">new</span> PositionsBySymbolsProvider());
        dataProviderLocator.register(<span class="hljs-keyword">new</span> QuotesBySymbolsProvider());
        dataProviderLocator.register(<span class="hljs-keyword">new</span> SecuritiesBySymbolsProvider());
        dataProviderLocator.register(<span class="hljs-keyword">new</span> UsersByIdsProvider());
        dataProviderLocator.register(<span class="hljs-keyword">new</span> WatchlistByUserProvider());
        dataProviderLocator.register(<span class="hljs-keyword">new</span> SymbolsProvider());
        dataProviderLocator.register(<span class="hljs-keyword">new</span> UsersProvider());
        dataProviderLocator.register(<span class="hljs-keyword">new</span> SymbolSearchProvider());
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-annotation">@GET</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> DataResponse <span class="hljs-title">query</span><span class="hljs-params">(Request webRequest)</span> </span>{
        <span class="hljs-keyword">final</span> DataRequest dataRequest = DataRequest.from(webRequest .getProperties());
        <span class="hljs-keyword">return</span> queryEngine.query(dataRequest);
    }
}

</code></pre>
<p>Here is an example client that passes a search query data field and requests quote data fields with company details</p>
<pre><code class="language-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testGetQuoteBySearch</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Throwable </span>{
    String jsonResp = TestWebUtils.httpGet(<span class="hljs-string">"http://localhost:"</span> + DEFAULT_PORT
                    + <span class="hljs-string">"/data?responseFields=exchange,symbol,quote.bidPrice,quote.askPrice,quote.sales,company.name&amp;symbolQuery=AAPL"</span>);
</code></pre>
<p>Note that above request will use three data providers, first it uses SymbolSearchProvider provider to search for matching symbols with given query. It then uses the symbol data field to request company and quote data fields from QuotesBySymbolsProvider and CompaniesBySymbolsProvider.</p>
<p>Here is an example JSON response from the data service:</p>
<pre><code class="language-javascript">{
    <span class="hljs-string">"queryResponse"</span>: {
        <span class="hljs-string">"responseFields"</span>: [
            [{
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"symbol"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-string">"AAPL_X"</span>
            }, {
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"quote.sales"</span>,
                <span class="hljs-string">"value"</span>: [
                    [{
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"symbol"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-string">"AAPL_X"</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.volume"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">23</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.exchange"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-string">"DOW"</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.date"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">1454472544364</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.price"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">65.34189108481885</span>
                    }],
                    [{
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"symbol"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-string">"AAPL_X"</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.volume"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">21</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.exchange"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-string">"NYSE"</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.date"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">1454472544364</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.price"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">60.5340513295224</span>
                    }],
                    [{
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"symbol"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-string">"AAPL_X"</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.volume"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">12</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.exchange"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-string">"NASDAQ"</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.date"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">1454472544364</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.price"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">45.527847983593546</span>
                    }],
                    [{
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"symbol"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-string">"AAPL_X"</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.volume"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">55</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.exchange"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-string">"DOW"</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.date"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">1454472544364</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.price"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">81.2969270317429</span>
                    }],
                    [{
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"symbol"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-string">"AAPL_X"</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.volume"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">47</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.exchange"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-string">"NYSE"</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.date"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">1454472544364</span>
                    }, {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"timeOfSale.price"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">45.74518654599762</span>
                    }]
                ]
            }, {
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"quote.askPrice"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-number">42.291074086023166</span>
            }, {
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"quote.bidPrice"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-number">29.06251067028489</span>
            }, {
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"exchange"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-string">"DOW"</span>
            }, {
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"company.name"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-string">"AAPL - name"</span>
            }],
            [{
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"symbol"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-string">"AAPL"</span>
            }, {
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"exchange"</span>,
                <span class="hljs-string">"value"</span>: <span class="hljs-string">"NASDAQ"</span>
            }]
        ],
        <span class="hljs-string">"errorsByProviderName"</span>: {},
        <span class="hljs-string">"providers"</span>: [<span class="hljs-string">"QuotesBySymbolsProvider"</span>, <span class="hljs-string">"SymbolSearchProvider"</span>, <span class="hljs-string">"CompaniesBySymbolsProvider"</span>]
    }
}
</code></pre>
<h2><a id="API_Doc_294"></a>API Doc</h2>
<p><a href="http://bhatti.github.io/PlexDataProviders/javadoc/">Java Doc</a></p>
<h2><a id="Sample_Applications_298"></a>Sample Applications</h2>
<pre><code>  You can view sample applications under dp-sample folder for detailed examples of services and various configurations.
</code></pre>
<h2><a id="Support_or_Contact_301"></a>Support or Contact</h2>
<pre><code>  Email bhatti AT plexobject DOT com for any questions or suggestions.
</code></pre>

</body></html>